<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Logistic-Trapezoid Cog Knob Prototype</title>
<style>
  :root {
    --bg: #545450;
    --panel: #2a2f36;
    --ink: #e9eef5;
    --accent: #7fc4ff;
  }
  html, body { height: 100%; }
  body {
    margin: 0;
    display: grid;
    grid-template-columns: 320px 1fr;
    grid-template-rows: 100%;
    gap: 0;
    background: var(--bg);
    color: var(--ink);
    font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }
  aside {
    background: var(--panel);
    padding: 14px 14px 20px;
    overflow: auto;
    box-shadow: inset -1px 0 0 rgba(255,255,255,0.03);
  }
  main {
    display: grid;
    place-items: center;
    overflow: hidden;
  }
  h1 { font-size: 16px; margin: 0 0 8px; }
  h2 { font-size: 13px; margin: 14px 0 6px; opacity: 0.85; }
  .row {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 10px;
    margin: 8px 0;
  }
  label { font-size: 12px; opacity: 0.9; }
  input[type=range] { width: 100%; }
  input[type=number] {
    width: 84px;
    background: #1f2329;
    border: 1px solid #0008;
    color: var(--ink);
    border-radius: 6px;
    padding: 6px 8px;
  }
  .small { font-size: 12px; opacity: 0.8; }
  .actions { margin-top: 14px; display: flex; gap: 8px; flex-wrap: wrap; }
  button {
    background: #303741;
    color: var(--ink);
    border: 1px solid #000a;
    border-radius: 8px;
    padding: 8px 12px;
    cursor: pointer;
  }
  button:hover { background: #37404c; }
  svg { width: min(92vmin, 1200px); height: min(92vmin, 1200px); }
  .credits { margin-top: 18px; opacity: 0.65; font-size: 12px; }
  .sep { margin: 10px 0; border-top: 1px solid #000a; }
</style>
</head>
<body>
  <aside>
    <h1>Cog Knob — Logistic Trapezoid</h1>
    <div class="row">
      <label>Teeth <span class="small" id="teethVal"></span></label>
      <input id="teeth" type="range" min="3" max="48" step="1" value="9">
    </div>
    <div class="row">
      <label>Depth (±) <span class="small" id="depthVal"></span></label>
      <input id="depth" type="range" min="0" max="0.3" step="0.002" value="0.040">
    </div>
    <div class="row">
      <label>Sharpness k <span class="small" id="kVal"></span></label>
      <input id="k" type="range" min="0.1" max="12" step="0.1" value="6">
    </div>
    <div class="row">
      <label>Samples <span class="small" id="sampVal"></span></label>
      <input id="samples" type="range" min="64" max="2048" step="32" value="512">
    </div>

    <div class="sep"></div>

    <div class="row">
      <label>Base radius px <span class="small" id="radVal"></span></label>
      <input id="radius" type="range" min="80" max="450" step="1" value="260">
    </div>
    <div class="row">
      <label>Inner hub % <span class="small" id="hubVal"></span></label>
      <input id="hub" type="range" min="0" max="0.95" step="0.01" value="0.88">
    </div>
    <div class="row">
      <label>Marker fraction <span class="small" id="markerFractionVal"></span></label>
      <input id="markerFraction" type="range" min="0" max="1" step="0.01" value="0.85">
    </div>
    <div class="row">
      <label>Stroke px <span class="small" id="strokeVal"></span></label>
      <input id="stroke" type="range" min="0" max="12" step="0.5" value="1">
    </div>
    <div class="row">
      <label>Rotation ° <span class="small" id="rotVal"></span></label>
      <input id="rotation" type="range" min="0" max="360" step="1" value="0">
    </div>

    <div class="sep"></div>

    <div class="row">
      <label><input id="useGradient" type="checkbox" checked> Gradient metal</label>
      <div></div>
    </div>
    <div class="row">
      <label>Light angle ° <span class="small" id="lightVal"></span></label>
      <input id="lightAngle" type="range" min="-180" max="180" step="1" value="-45">
    </div>
    <div class="row">
      <label><input id="shadow" type="checkbox" checked> Drop shadow</label>
      <div></div>
    </div>
    <div class="row">
      <label><input id="animate" type="checkbox"> Animate rotation</label>
      <div></div>
    </div>

    <div class="actions">
      <button id="exportSVG">Export SVG</button>
      <button id="exportPNG">Export PNG</button>
      <button id="randomize">Randomize</button>
      <button id="reset">Reset</button>
    </div>

    <div class="credits">
      Logistic trap function: <code>f(θ)=2·σ(k·sin(Nθ))−1</code>, σ(x)=1/(1+e<sup>−x</sup>)<br/>
      Everything here is static HTML+SVG — copy into JUCE by sampling the path.
    </div>
  </aside>
  <main>
    <svg id="scene" viewBox="-600 -600 1200 1200" role="img" aria-label="Cog knob prototype">
      <defs>
        <filter id="shadowFilter" x="-50%" y="-50%" width="200%" height="200%">
          <feOffset dx="0" dy="10" result="off"/>
          <feGaussianBlur in="off" stdDeviation="10" result="blur"/>
          <feColorMatrix type="matrix"
            values="0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 0.5 0" result="shadow"/>
          <feMerge>
            <feMergeNode in="shadow"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
        <radialGradient id="metalGrad" cx="0" cy="0" r="260" gradientUnits="userSpaceOnUse">
          <stop offset="0%" stop-color="#d9dfe6"/>
          <stop offset="60%" stop-color="#8f9aa8"/>
          <stop offset="100%" stop-color="#3b4350"/>
        </radialGradient>
      </defs>
      <g id="knobGroup">
        <path id="cog" d="M 0 0" fill="url(#metalGrad)" stroke="#0b0d11" stroke-width="2" />
        <circle id="hubCircle" r="200" fill="#483890" stroke="#000" stroke-width="1" opacity="1"/>
        <circle id="marker" r="16" fill="#121008" stroke="#000" stroke-width="1" opacity="0.9"/>
      </g>
    </svg>
  </main>
<script>
const el = (id) => document.getElementById(id);
const inputs = ["teeth","depth","k","samples","radius","hub","markerFraction","stroke","rotation","useGradient","lightAngle","shadow","animate"];

const state = {
  teeth: 12,
  depth: 0.10,
  k: 5.0,
  samples: 512,
  radius: 260,
  hub: 0.5,
  markerFraction: 1.0,
  stroke: 2,
  rotation: 0,
  useGradient: true,
  lightAngle: -45,
  shadow: true,
  animate: false,
};

// Sync UI readouts
const readouts = {
  teethVal: (v)=> `${v}`,
  depthVal: (v)=> `${(+v).toFixed(3)}`,
  kVal: (v)=> `${(+v).toFixed(1)}`,
  sampVal: (v)=> `${v}`,
  radVal: (v)=> `${v}px`,
  hubVal: (v)=> `${Math.round(v*100)}%`,
  markerFractionVal: (v)=> `${(+v).toFixed(2)}`,
  strokeVal: (v)=> `${v}px`,
  rotVal: (v)=> `${v}°`,
  lightVal: (v)=> `${v}°`,
};

function sigmoid(x){ return 1/(1+Math.exp(-x)); }

// logistic trapezoid wave
function wave(theta, N, k){
  const s = Math.sin(N * theta);
  return 2*sigmoid(k*s) - 1; // in (-1,1)
}

// Build SVG path from samples
function buildPath(cx, cy, baseR, depth, N, k, samples){
  let d = "";
  for (let i=0; i<=samples; i++){
    const t = i / samples;
    const theta = t * Math.PI * 2;
    const mod = wave(theta, N, k);
    const r = baseR * (1 + depth * mod);
    const x = cx + r * Math.cos(theta);
    const y = cy + r * Math.sin(theta);
    d += (i===0 ? "M " : " L ") + x.toFixed(3) + " " + y.toFixed(3);
  }
  d += " Z";
  return d;
}

// Lighting: position radial gradient so highlight stays world-aligned
function updateGradient(angleDeg, radius, knobRotation){
  const grad = document.querySelector("#metalGrad");
  if (!grad) return;
  const a = angleDeg * Math.PI / 180;
  const offset = radius * 0.35;
  const worldX = offset * Math.cos(a);
  const worldY = offset * Math.sin(a);
  const rot = knobRotation * Math.PI / 180;
  const cosR = Math.cos(rot);
  const sinR = Math.sin(rot);
  // Convert world-space vector to knob-local coordinates (inverse rotation)
  const cx = worldX * cosR + worldY * sinR;
  const cy = -worldX * sinR + worldY * cosR;
  const r = radius * 1.1;
  const format = (n) => n.toFixed(2);
  grad.setAttribute("cx", format(cx));
  grad.setAttribute("cy", format(cy));
  grad.setAttribute("fx", format(cx));
  grad.setAttribute("fy", format(cy));
  grad.setAttribute("r", format(r));
}

function render(){
  // Read UI
  for (const id of inputs){
    const input = el(id);
    state[id] = (input.type === "checkbox") ? input.checked : parseFloat(input.value);
  }
  // Update readouts
  for (const key in readouts){
    const inputId = key.replace("Val","");
    const v = state[inputId];
    el(key).textContent = readouts[key](v);
  }

  const cog = el("cog");
  const group = el("knobGroup");
  const hub = el("hubCircle");
  const marker = el("marker");

  // Marker position (top of knob before rotation transform)
  const hubRadius = state.radius * state.hub;
  const pointerRadius = hubRadius * state.markerFraction;
  marker.setAttribute("cx", "0");
  marker.setAttribute("cy", (-pointerRadius).toFixed(2));

  // Path
  cog.setAttribute("d", buildPath(0,0,state.radius,state.depth,state.teeth,state.k,state.samples));

  // Stroke / fill
  cog.setAttribute("stroke-width", state.stroke);
  cog.setAttribute("fill", state.useGradient ? "url(#metalGrad)" : "#a5adb8");

  // Shadow
  group.setAttribute("filter", state.shadow ? "url(#shadowFilter)" : "none");

  // Hub
  hub.setAttribute("r", (state.radius * state.hub).toFixed(2));

  // Rotation
  group.setAttribute("transform", `rotate(${state.rotation})`);

  // Gradient
  updateGradient(state.lightAngle, state.radius, state.rotation);
}

function randomize(){
  el("teeth").value = Math.floor(6 + Math.random()*30);
  el("depth").value = (0.04 + Math.random()*0.18).toFixed(3);
  el("k").value = (2 + Math.random()*8).toFixed(1);
  el("markerFraction").value = Math.random().toFixed(2);
  el("rotation").value = Math.floor(Math.random()*360);
  render();
}

function reset(){
  el("teeth").value = 12;
  el("depth").value = 0.10;
  el("k").value = 5.0;
  el("samples").value = 512;
  el("radius").value = 260;
  el("hub").value = 0.5;
  el("markerFraction").value = 1;
  el("stroke").value = 2;
  el("rotation").value = 0;
  el("useGradient").checked = true;
  el("lightAngle").value = -45;
  el("shadow").checked = true;
  el("animate").checked = false;
  render();
}

// Export helpers
function exportSVG(){
  const svg = el("scene").cloneNode(true);
  svg.removeAttribute("style");
  const blob = new Blob([svg.outerHTML], {type: "image/svg+xml"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "cog_knob.svg";
  a.click();
  URL.revokeObjectURL(url);
}

function exportPNG(){
  const serializer = new XMLSerializer();
  const svgStr = serializer.serializeToString(el("scene"));
  const img = new Image();
  const url = URL.createObjectURL(new Blob([svgStr], {type: "image/svg+xml"}));
  img.onload = () => {
    const canvas = document.createElement("canvas");
    const side = 1200;
    canvas.width = side; canvas.height = side;
    const ctx = canvas.getContext("2d");
    ctx.fillStyle = "#15181d";
    ctx.fillRect(0,0,side,side);
    ctx.drawImage(img,0,0,side,side);
    canvas.toBlob((blob)=>{
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "cog_knob.png";
      a.click();
    });
    URL.revokeObjectURL(url);
  };
  img.src = url;
}

// Animate rotation if enabled
let last = performance.now();
function tick(ts){
  const dt = Math.min(33, ts - last);
  last = ts;
  if (el("animate").checked){
    const rot = parseFloat(el("rotation").value);
    el("rotation").value = (rot + dt*0.02) % 360;
    render();
  }
  requestAnimationFrame(tick);
}

// Wire up events
for (const id of inputs){
  el(id).addEventListener("input", render);
}
el("exportSVG").addEventListener("click", exportSVG);
el("exportPNG").addEventListener("click", exportPNG);
el("randomize").addEventListener("click", randomize);
el("reset").addEventListener("click", reset);

// Initial render
render();
requestAnimationFrame(tick);
</script>
</body>
</html>
